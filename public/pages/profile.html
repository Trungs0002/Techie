<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>H·ªì s∆° c·ªßa t√¥i - QuizMaster</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/components.css">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body class="bg-gray-50">
  <!-- Navigation -->
  <nav class="bg-white shadow-sm sticky top-0 z-40">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-2">
          <i class="fas fa-graduation-cap text-2xl text-blue-600"></i>
          <span class="text-xl font-bold text-gray-800">QuizMaster</span>
        </div>

        <div class="hidden md:flex items-center space-x-6">
          <a href="/pages/dashboard.html" class="text-gray-600 hover:text-blue-600 transition flex items-center gap-2">
            <i class="fas fa-home"></i>
            Dashboard
          </a>
          <a href="/pages/subjects.html" class="text-gray-600 hover:text-blue-600 transition flex items-center gap-2">
            <i class="fas fa-book"></i>
            M√¥n h·ªçc
          </a>
          <a href="/pages/history.html" class="text-gray-600 hover:text-blue-600 transition flex items-center gap-2">
            <i class="fas fa-history"></i>
            L·ªãch s·ª≠
          </a>
        </div>

        <div class="flex items-center space-x-4">
          <button class="relative text-gray-600 hover:text-blue-600 transition">
            <i class="fas fa-bell text-xl"></i>
            <span class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">3</span>
          </button>

          <div class="relative">
            <button id="userMenuBtn" class="flex items-center space-x-2 hover:bg-gray-100 rounded-lg px-3 py-2 transition">
              <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white font-semibold">
                <span id="userInitial">U</span>
              </div>
              <span class="hidden md:block text-gray-700 font-medium" id="userName">User</span>
              <i class="fas fa-chevron-down text-gray-500 text-sm"></i>
            </button>

            <div id="userMenu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-50">
              <a href="/pages/profile.html" class="block px-4 py-2 text-blue-600 bg-blue-50 transition">
                <i class="fas fa-user mr-2"></i>
                H·ªì s∆°
              </a>
              <a href="/pages/settings.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition">
                <i class="fas fa-cog mr-2"></i>
                C√†i ƒë·∫∑t
              </a>
              <hr class="my-2">
              <button id="logoutBtn" class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 transition">
                <i class="fas fa-sign-out-alt mr-2"></i>
                ƒêƒÉng xu·∫•t
              </button>
            </div>
          </div>

          <button id="mobileMenuBtn" class="md:hidden text-gray-600">
            <i class="fas fa-bars text-xl"></i>
          </button>
        </div>
      </div>

      <div id="mobileMenu" class="hidden md:hidden border-t border-gray-200 py-4">
        <a href="/pages/dashboard.html" class="block py-2 text-gray-600 hover:text-blue-600">
          <i class="fas fa-home mr-2"></i>
          Dashboard
        </a>
        <a href="/pages/subjects.html" class="block py-2 text-gray-600 hover:text-blue-600">
          <i class="fas fa-book mr-2"></i>
          M√¥n h·ªçc
        </a>
        <a href="/pages/history.html" class="block py-2 text-gray-600 hover:text-blue-600">
          <i class="fas fa-history mr-2"></i>
          L·ªãch s·ª≠
        </a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-6">
    <div class="max-w-5xl mx-auto">
      <!-- Header -->
      <div class="mb-6">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">
          <i class="fas fa-user text-blue-600"></i>
          H·ªì s∆° c·ªßa t√¥i
        </h1>
        <p class="text-gray-600">Qu·∫£n l√Ω th√¥ng tin c√° nh√¢n v√† theo d√µi ti·∫øn ƒë·ªô h·ªçc t·∫≠p</p>
      </div>

      <div class="grid lg:grid-cols-3 gap-6">
        <!-- Left Column - Profile Info -->
        <div class="lg:col-span-1 space-y-6">
          <!-- Avatar Card -->
          <div class="card bg-white text-center">
            <div class="relative inline-block">
              <div class="w-32 h-32 rounded-full bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center text-white text-5xl font-bold shadow-lg" id="avatarDisplay">
                U
              </div>
              <button onclick="changeAvatar()" class="absolute bottom-0 right-0 w-10 h-10 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition shadow-lg">
                <i class="fas fa-camera"></i>
              </button>
              <input type="file" id="avatarInput" accept="image/*" class="hidden">
            </div>

            <h2 class="text-xl font-bold text-gray-900 mt-4" id="profileName">Loading...</h2>
            <p class="text-gray-600" id="profileEmail">email@example.com</p>
            
            <div class="flex items-center justify-center gap-2 mt-3">
              <span class="badge badge-success">
                <i class="fas fa-check-circle"></i>
                Email ƒë√£ x√°c th·ª±c
              </span>
            </div>

            <div class="mt-4 pt-4 border-t border-gray-200">
              <div class="text-sm text-gray-600">Th√†nh vi√™n t·ª´</div>
              <div class="font-semibold text-gray-900" id="memberSince">-</div>
            </div>
          </div>

          <!-- Quick Stats -->
          <div class="card bg-gradient-to-br from-blue-600 to-indigo-600 text-white">
            <h3 class="font-semibold mb-4 flex items-center gap-2">
              <i class="fas fa-chart-line"></i>
              Th·ªëng k√™ nhanh
            </h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <span class="opacity-90">B√†i thi ƒë√£ l√†m</span>
                <span class="text-2xl font-bold" id="totalExams">0</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="opacity-90">ƒêi·ªÉm trung b√¨nh</span>
                <span class="text-2xl font-bold" id="avgScore">0%</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="opacity-90">Th·ª© h·∫°ng</span>
                <span class="text-2xl font-bold" id="userRank">#-</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="opacity-90">Streak hi·ªán t·∫°i</span>
                <span class="text-2xl font-bold" id="currentStreak">0üî•</span>
              </div>
            </div>
          </div>

          <!-- Achievements -->
          <div class="card bg-white">
            <h3 class="font-semibold text-gray-900 mb-4 flex items-center gap-2">
              <i class="fas fa-trophy text-yellow-500"></i>
              Th√†nh t√≠ch
            </h3>
            <div class="grid grid-cols-3 gap-3" id="achievementsList">
              <div class="text-center p-3 bg-gray-50 rounded-lg" title="First Win">
                <div class="text-3xl mb-1">üèÜ</div>
                <div class="text-xs text-gray-600">First Win</div>
              </div>
              <div class="text-center p-3 bg-gray-50 rounded-lg" title="Perfect Score">
                <div class="text-3xl mb-1">üíØ</div>
                <div class="text-xs text-gray-600">Perfect</div>
              </div>
              <div class="text-center p-3 bg-gray-50 rounded-lg" title="Speed Demon">
                <div class="text-3xl mb-1">‚ö°</div>
                <div class="text-xs text-gray-600">Fast</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column - Details & Settings -->
        <div class="lg:col-span-2 space-y-6">
          <!-- Tabs -->
          <div class="card bg-white">
            <div class="flex border-b border-gray-200 overflow-x-auto">
              <button onclick="switchTab('info')" id="tabInfo" class="tab-btn active">
                <i class="fas fa-info-circle"></i>
                Th√¥ng tin
              </button>
              <button onclick="switchTab('stats')" id="tabStats" class="tab-btn">
                <i class="fas fa-chart-bar"></i>
                Th·ªëng k√™
              </button>
              <button onclick="switchTab('security')" id="tabSecurity" class="tab-btn">
                <i class="fas fa-lock"></i>
                B·∫£o m·∫≠t
              </button>
            </div>

            <!-- Info Tab -->
            <div id="infoTab" class="tab-content">
              <form id="profileForm" class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-user mr-1"></i>
                    H·ªç v√† t√™n *
                  </label>
                  <input 
                    type="text" 
                    id="inputName"
                    class="form-input w-full" 
                    placeholder="Nguy·ªÖn VƒÉn A"
                    required
                  >
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-envelope mr-1"></i>
                    Email *
                  </label>
                  <input 
                    type="email" 
                    id="inputEmail"
                    class="form-input w-full" 
                    placeholder="email@example.com"
                    required
                    disabled
                  >
                  <p class="text-xs text-gray-500 mt-1">Email kh√¥ng th·ªÉ thay ƒë·ªïi</p>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-phone mr-1"></i>
                    S·ªë ƒëi·ªán tho·∫°i
                  </label>
                  <input 
                    type="tel" 
                    id="inputPhone"
                    class="form-input w-full" 
                    placeholder="0123456789"
                  >
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-birthday-cake mr-1"></i>
                    Ng√†y sinh
                  </label>
                  <input 
                    type="date" 
                    id="inputBirthday"
                    class="form-input w-full"
                  >
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-venus-mars mr-1"></i>
                    Gi·ªõi t√≠nh
                  </label>
                  <select id="inputGender" class="form-input w-full">
                    <option value="">Ch·ªçn gi·ªõi t√≠nh</option>
                    <option value="male">Nam</option>
                    <option value="female">N·ªØ</option>
                    <option value="other">Kh√°c</option>
                  </select>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-map-marker-alt mr-1"></i>
                    ƒê·ªãa ch·ªâ
                  </label>
                  <textarea 
                    id="inputAddress"
                    class="form-input w-full" 
                    rows="2"
                    placeholder="ƒê·ªãa ch·ªâ c·ªßa b·∫°n"
                  ></textarea>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-quote-left mr-1"></i>
                    Ti·ªÉu s·ª≠
                  </label>
                  <textarea 
                    id="inputBio"
                    class="form-input w-full" 
                    rows="3"
                    placeholder="Vi·∫øt v√†i d√≤ng v·ªÅ b·∫£n th√¢n..."
                    maxlength="200"
                  ></textarea>
                  <p class="text-xs text-gray-500 mt-1">
                    <span id="bioCount">0</span>/200 k√Ω t·ª±
                  </p>
                </div>

                <div class="flex gap-3 pt-4 border-t border-gray-200">
                  <button type="submit" class="btn btn-primary flex-1">
                    <i class="fas fa-save"></i>
                    L∆∞u thay ƒë·ªïi
                  </button>
                  <button type="button" onclick="resetForm()" class="btn btn-secondary">
                    <i class="fas fa-undo"></i>
                    H·ªßy
                  </button>
                </div>
              </form>
            </div>

            <!-- Stats Tab -->
            <div id="statsTab" class="tab-content hidden">
              <div class="space-y-6">
                <!-- Performance Chart -->
                <div>
                  <h4 class="font-semibold text-gray-900 mb-4">Ti·∫øn ƒë·ªô h·ªçc t·∫≠p (30 ng√†y qua)</h4>
                  <canvas id="progressChart" height="100"></canvas>
                </div>

                <!-- Subject Performance -->
                <div>
                  <h4 class="font-semibold text-gray-900 mb-4">Th√†nh t√≠ch theo m√¥n h·ªçc</h4>
                  <div class="space-y-3" id="subjectStats">
                    <!-- Will be populated by JS -->
                  </div>
                </div>

                <!-- Activity Heatmap -->
                <div>
                  <h4 class="font-semibold text-gray-900 mb-4">Ho·∫°t ƒë·ªông trong tu·∫ßn</h4>
                  <div class="grid grid-cols-7 gap-2">
                    <div class="text-center text-xs text-gray-600 py-2">T2</div>
                    <div class="text-center text-xs text-gray-600 py-2">T3</div>
                    <div class="text-center text-xs text-gray-600 py-2">T4</div>
                    <div class="text-center text-xs text-gray-600 py-2">T5</div>
                    <div class="text-center text-xs text-gray-600 py-2">T6</div>
                    <div class="text-center text-xs text-gray-600 py-2">T7</div>
                    <div class="text-center text-xs text-gray-600 py-2">CN</div>
                  </div>
                  <div class="grid grid-cols-7 gap-2" id="activityHeatmap">
                    <!-- Will be populated by JS -->
                  </div>
                </div>
              </div>
            </div>

            <!-- Security Tab -->
            <div id="securityTab" class="tab-content hidden">
              <div class="space-y-6">
                <!-- Change Password -->
                <div class="p-4 border-2 border-gray-200 rounded-lg">
                  <h4 class="font-semibold text-gray-900 mb-4">
                    <i class="fas fa-key text-blue-600"></i>
                    ƒê·ªïi m·∫≠t kh·∫©u
                  </h4>
                  <form id="passwordForm" class="space-y-4">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">
                        M·∫≠t kh·∫©u hi·ªán t·∫°i *
                      </label>
                      <div class="relative">
                        <input 
                          type="password" 
                          id="currentPassword"
                          class="form-input w-full pr-10" 
                          required
                        >
                        <button type="button" onclick="togglePassword('currentPassword')" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700">
                          <i class="fas fa-eye"></i>
                        </button>
                      </div>
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">
                        M·∫≠t kh·∫©u m·ªõi *
                      </label>
                      <div class="relative">
                        <input 
                          type="password" 
                          id="newPassword"
                          class="form-input w-full pr-10" 
                          required
                        >
                        <button type="button" onclick="togglePassword('newPassword')" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700">
                          <i class="fas fa-eye"></i>
                        </button>
                      </div>
                      <div class="mt-2 space-y-1">
                        <div class="flex items-center gap-2 text-sm">
                          <i id="lengthCheck" class="fas fa-circle text-gray-300 text-xs"></i>
                          <span class="text-gray-600">√çt nh·∫•t 8 k√Ω t·ª±</span>
                        </div>
                        <div class="flex items-center gap-2 text-sm">
                          <i id="letterCheck" class="fas fa-circle text-gray-300 text-xs"></i>
                          <span class="text-gray-600">C√≥ ch·ªØ c√°i</span>
                        </div>
                        <div class="flex items-center gap-2 text-sm">
                          <i id="numberCheck" class="fas fa-circle text-gray-300 text-xs"></i>
                          <span class="text-gray-600">C√≥ s·ªë</span>
                        </div>
                      </div>
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">
                        X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi *
                      </label>
                      <div class="relative">
                        <input 
                          type="password" 
                          id="confirmPassword"
                          class="form-input w-full pr-10" 
                          required
                        >
                        <button type="button" onclick="togglePassword('confirmPassword')" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700">
                          <i class="fas fa-eye"></i>
                        </button>
                      </div>
                    </div>

                    <button type="submit" class="btn btn-primary w-full">
                      <i class="fas fa-save"></i>
                      ƒê·ªïi m·∫≠t kh·∫©u
                    </button>
                  </form>
                </div>

                <!-- Two-Factor Authentication -->
                <div class="p-4 border-2 border-gray-200 rounded-lg">
                  <div class="flex items-start justify-between mb-3">
                    <div>
                      <h4 class="font-semibold text-gray-900">
                        <i class="fas fa-shield-alt text-green-600"></i>
                        X√°c th·ª±c hai y·∫øu t·ªë (2FA)
                      </h4>
                      <p class="text-sm text-gray-600 mt-1">TƒÉng c∆∞·ªùng b·∫£o m·∫≠t t√†i kho·∫£n</p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" id="toggle2FA" class="sr-only peer">
                      <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                    </label>
                  </div>
                  <div id="2faStatus" class="text-sm text-gray-600">
                    <span class="badge badge-secondary">Ch∆∞a k√≠ch ho·∫°t</span>
                  </div>
                </div>

                <!-- Delete Account -->
                <div class="p-4 border-2 border-red-200 rounded-lg bg-red-50">
                  <h4 class="font-semibold text-red-900 mb-2">
                    <i class="fas fa-exclamation-triangle"></i>
                    X√≥a t√†i kho·∫£n
                  </h4>
                  <p class="text-sm text-red-700 mb-3">
                    H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c. T·∫•t c·∫£ d·ªØ li·ªáu c·ªßa b·∫°n s·∫Ω b·ªã x√≥a vƒ©nh vi·ªÖn.
                  </p>
                  <button onclick="deleteAccount()" class="btn btn-danger btn-sm">
                    <i class="fas fa-trash"></i>
                    X√≥a t√†i kho·∫£n
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Scripts -->
  <script src="/assets/js/config.js"></script>
  <script src="/assets/js/utils.js"></script>
  <script src="/assets/js/api.js"></script>
  <script src="/assets/js/auth.js"></script>
  
  <script>
    // Require authentication
    if (!Auth.requireAuth()) {
      // Will redirect to login
    }

    // Get current user
    let currentUser = Auth.getCurrentUser();
    let originalData = {};

    // Initialize
    function init() {
      loadUserProfile();
      setupEventListeners();
    }

    // Load user profile
    async function loadUserProfile() {
      try {
        Utils.showLoading('ƒêang t·∫£i h·ªì s∆°...');

        const response = await API.get('/auth/me');
        const data = response.data || response;
        currentUser = data.user || data;
        originalData = { ...currentUser };

        displayProfile();
        displayStats();
        Utils.hideLoading();

      } catch (error) {
        console.error('Error loading profile:', error);
        Utils.hideLoading();
        Utils.showToast('Kh√¥ng th·ªÉ t·∫£i h·ªì s∆°. Vui l√≤ng th·ª≠ l·∫°i.', 'error');
      }
    }

    // Display profile
    function displayProfile() {
      // Header
      document.getElementById('userName').textContent = currentUser.name;
      document.getElementById('userInitial').textContent = currentUser.name[0].toUpperCase();

      // Profile card
      document.getElementById('profileName').textContent = currentUser.name;
      document.getElementById('profileEmail').textContent = currentUser.email;
      document.getElementById('avatarDisplay').textContent = currentUser.name[0].toUpperCase();
      
      const memberSince = new Date(currentUser.createdAt || Date.now());
      document.getElementById('memberSince').textContent = Utils.formatDate(memberSince, 'DD/MM/YYYY');

      // Form fields
      document.getElementById('inputName').value = currentUser.name || '';
      document.getElementById('inputEmail').value = currentUser.email || '';
      document.getElementById('inputPhone').value = currentUser.phone || '';
      document.getElementById('inputBirthday').value = currentUser.birthday || '';
      document.getElementById('inputGender').value = currentUser.gender || '';
      document.getElementById('inputAddress').value = currentUser.address || '';
      document.getElementById('inputBio').value = currentUser.bio || '';
      
      updateBioCount();

      // Quick stats
      document.getElementById('totalExams').textContent = currentUser.stats?.totalExams || 0;
      document.getElementById('avgScore').textContent = `${currentUser.stats?.avgScore || 0}%`;
      document.getElementById('userRank').textContent = `#${currentUser.stats?.rank || '-'}`;
      document.getElementById('currentStreak').textContent = `${currentUser.stats?.streak || 0}üî•`;
    }

    // Display stats
    function displayStats() {
      // Progress chart
      const ctx = document.getElementById('progressChart').getContext('2d');
      const last30Days = Array.from({length: 30}, (_, i) => {
        const date = new Date();
        date.setDate(date.getDate() - (29 - i));
        return date.getDate() + '/' + (date.getMonth() + 1);
      });
      
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: last30Days,
          datasets: [{
            label: 'ƒêi·ªÉm s·ªë',
            data: Array.from({length: 30}, () => Math.floor(Math.random() * 40) + 60),
            borderColor: '#3B82F6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: {
            y: {
              beginAtZero: true,
              max: 100
            }
          }
        }
      });

      // Subject stats
      const subjects = [
        { name: 'To√°n h·ªçc', exams: 15, avgScore: 85, color: 'blue' },
        { name: 'V·∫≠t l√Ω', exams: 12, avgScore: 78, color: 'green' },
        { name: 'H√≥a h·ªçc', exams: 10, avgScore: 72, color: 'purple' },
        { name: 'Ti·∫øng Anh', exams: 8, avgScore: 90, color: 'red' }
      ];

      document.getElementById('subjectStats').innerHTML = subjects.map(sub => `
        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-${sub.color}-100 rounded-lg flex items-center justify-center">
              <i class="fas fa-book text-${sub.color}-600"></i>
            </div>
            <div>
              <div class="font-semibold text-gray-900">${sub.name}</div>
              <div class="text-sm text-gray-600">${sub.exams} b√†i thi</div>
            </div>
          </div>
          <div class="text-right">
            <div class="text-lg font-bold text-gray-900">${sub.avgScore}%</div>
            <div class="progress w-24 mt-1">
              <div class="progress-bar bg-${sub.color}-500" style="width: ${sub.avgScore}%"></div>
            </div>
          </div>
        </div>
      `).join('');

      // Activity heatmap
      const heatmap = document.getElementById('activityHeatmap');
      heatmap.innerHTML = Array.from({length: 7}, () => {
        const activity = Math.floor(Math.random() * 5);
        const colors = ['bg-gray-100', 'bg-green-200', 'bg-green-300', 'bg-green-400', 'bg-green-500'];
        return `<div class="${colors[activity]} h-12 rounded-lg flex items-center justify-center text-xs font-semibold text-gray-700">${activity > 0 ? activity : ''}</div>`;
      }).join('');
    }

    // Setup event listeners
    function setupEventListeners() {
      // User menu
      const userMenuBtn = document.getElementById('userMenuBtn');
      const userMenu = document.getElementById('userMenu');
      
      userMenuBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        userMenu.classList.toggle('hidden');
      });

      document.addEventListener('click', () => {
        userMenu.classList.add('hidden');
      });

      // Mobile menu
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      const mobileMenu = document.getElementById('mobileMenu');
      mobileMenuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
      });

      // Logout
      document.getElementById('logoutBtn').addEventListener('click', () => {
        if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
          Auth.logout();
        }
      });

      // Profile form
      document.getElementById('profileForm').addEventListener('submit', handleProfileSubmit);

      // Password form
      document.getElementById('passwordForm').addEventListener('submit', handlePasswordSubmit);

      // Bio counter
      document.getElementById('inputBio').addEventListener('input', updateBioCount);

      // Password validation
      document.getElementById('newPassword').addEventListener('input', validatePassword);

      // 2FA toggle
      document.getElementById('toggle2FA').addEventListener('change', toggle2FA);
    }

    // Tab switching
    function switchTab(tab) {
      // Remove active from all tabs
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));

      // Activate selected tab
      document.getElementById(`tab${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.add('active');
      document.getElementById(`${tab}Tab`).classList.remove('hidden');
    }

    // Handle profile submit
    async function handleProfileSubmit(e) {
      e.preventDefault();

      const formData = {
        name: document.getElementById('inputName').value.trim(),
        phone: document.getElementById('inputPhone').value.trim(),
        birthday: document.getElementById('inputBirthday').value,
        gender: document.getElementById('inputGender').value,
        address: document.getElementById('inputAddress').value.trim(),
        bio: document.getElementById('inputBio').value.trim()
      };

      try {
        Utils.showLoading('ƒêang l∆∞u...');
        
        const response = await API.put('/users/profile', formData);
        
        currentUser = { ...currentUser, ...formData };
        originalData = { ...currentUser };
        
        Auth.setUser(currentUser); // Update localStorage
        displayProfile();
        
        Utils.hideLoading();
        Utils.showToast('C·∫≠p nh·∫≠t th√†nh c√¥ng!', 'success');

      } catch (error) {
        console.error('Error updating profile:', error);
        Utils.hideLoading();
        Utils.showToast(error.message || 'C·∫≠p nh·∫≠t th·∫•t b·∫°i', 'error');
      }
    }

    // Handle password submit
    async function handlePasswordSubmit(e) {
      e.preventDefault();

      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;

      if (newPassword !== confirmPassword) {
        Utils.showToast('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp', 'error');
        return;
      }

      if (!Utils.isValidPassword(newPassword)) {
        Utils.showToast('M·∫≠t kh·∫©u kh√¥ng ƒë·ªß m·∫°nh', 'error');
        return;
      }

      try {
        Utils.showLoading('ƒêang ƒë·ªïi m·∫≠t kh·∫©u...');
        
        await API.put('/users/password', { currentPassword, newPassword });
        
        Utils.hideLoading();
        Utils.showToast('ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!', 'success');
        
        // Reset form
        document.getElementById('passwordForm').reset();

      } catch (error) {
        console.error('Error changing password:', error);
        Utils.hideLoading();
        Utils.showToast(error.message || 'ƒê·ªïi m·∫≠t kh·∫©u th·∫•t b·∫°i', 'error');
      }
    }

    // Reset form
    function resetForm() {
      if (confirm('H·ªßy c√°c thay ƒë·ªïi?')) {
        displayProfile();
      }
    }

    // Update bio counter
    function updateBioCount() {
      const bio = document.getElementById('inputBio').value;
      document.getElementById('bioCount').textContent = bio.length;
    }

    // Validate password
    function validatePassword() {
      const password = document.getElementById('newPassword').value;
      
      document.getElementById('lengthCheck').className = password.length >= 8 
        ? 'fas fa-check-circle text-green-500 text-xs' 
        : 'fas fa-circle text-gray-300 text-xs';
      
      document.getElementById('letterCheck').className = /[a-zA-Z]/.test(password)
        ? 'fas fa-check-circle text-green-500 text-xs'
        : 'fas fa-circle text-gray-300 text-xs';
      
      document.getElementById('numberCheck').className = /[0-9]/.test(password)
        ? 'fas fa-check-circle text-green-500 text-xs'
        : 'fas fa-circle text-gray-300 text-xs';
    }

    // Toggle password visibility
    function togglePassword(fieldId) {
      const field = document.getElementById(fieldId);
      const icon = field.nextElementSibling.querySelector('i');
      
      if (field.type === 'password') {
        field.type = 'text';
        icon.className = 'fas fa-eye-slash';
      } else {
        field.type = 'password';
        icon.className = 'fas fa-eye';
      }
    }

    // Change avatar
    function changeAvatar() {
      document.getElementById('avatarInput').click();
      
      document.getElementById('avatarInput').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          Utils.showToast('T√≠nh nƒÉng upload avatar ƒëang ph√°t tri·ªÉn', 'info');
        }
      });
    }

    // Toggle 2FA
    function toggle2FA(e) {
      if (e.target.checked) {
        Utils.showToast('T√≠nh nƒÉng 2FA ƒëang ph√°t tri·ªÉn', 'info');
        e.target.checked = false;
      }
    }

    // Delete account
    function deleteAccount() {
      const confirmation = prompt('Nh·∫≠p "X√ìA T√ÄI KHO·∫¢N" ƒë·ªÉ x√°c nh·∫≠n:');
      if (confirmation === 'X√ìA T√ÄI KHO·∫¢N') {
        Utils.showToast('T√≠nh nƒÉng ƒëang ph√°t tri·ªÉn', 'info');
      }
    }

    // Initialize
    init();
  </script>

  <style>
    .tab-btn {
      padding: 1rem 1.5rem;
      border-bottom: 2px solid transparent;
      color: #6B7280;
      font-weight: 500;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .tab-btn:hover {
      color: #3B82F6;
    }

    .tab-btn.active {
      color: #3B82F6;
      border-bottom-color: #3B82F6;
    }

    .tab-content {
      padding: 1.5rem 0;
    }
  </style>
</body>
</html>
